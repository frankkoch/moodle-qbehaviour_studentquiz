define(["jquery"],function(a){function b(){a(".studentquiz_behaviour .show_more").off("click").on("click",function(){a(".studentquiz_behaviour .comment_list div").removeClass("hidden"),a(this).addClass("hidden"),a(".studentquiz_behaviour .show_less").removeClass("hidden")}),a(".studentquiz_behaviour .show_less").off("click").on("click",function(){a(".studentquiz_behaviour .comment_list div").each(function(b){b>1&&!a(this).hasClass("button_controls")&&a(this).addClass("hidden")}),a(this).addClass("hidden"),a(".studentquiz_behaviour .show_more").removeClass("hidden")}),a(".studentquiz_behaviour .remove_action").off("click").on("click",function(){var b=a(this).attr("data-question_id"),d=a(this).closest(".comments").children(".comment_list");a.post(a("#baseurlmoodle").val()+"/question/behaviour/studentquiz/remove.php",{id:a(this).attr("data-id"),sesskey:M.cfg.sesskey},function(){c(b,d)})})}function c(c,d){var e=a("#baseurlmoodle").val()+"/question/behaviour/studentquiz/comment_list.php?questionid=";e+=c+"&sesskey="+M.cfg.sesskey,a.get(e,function(a){d.html(a),b()})}return{initialise:function(){a(".studentquiz_behaviour .add_comment").off("click").on("click",function(){var b=a(this).closest(".comments"),d=b.find(".add_comment_field"),e=d.attr("name").substr(1),f=b.children(".comment_list");a.post(a("#baseurlmoodle").val()+"/question/behaviour/studentquiz/save.php",{save:"comment",questionid:e,sesskey:M.cfg.sesskey,text:d.val()},function(){d.val(""),c(e,f)})}),a(".studentquiz_behaviour .vote .rating .rateable").off("click").on("click",function(){var b=a(this).attr("data-rate"),c=a(this);a.post(a("#baseurlmoodle").val()+"/question/behaviour/studentquiz/save.php",{save:"vote",questionid:a(this).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:b},function(){var d=c.closest(".rating").children("span");d.removeClass("star"),d.addClass("star-empty"),d.each(function(){a(this).attr("data-rate")<=b&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .vote > .error").addClass("hide")})}),a('.submitbtns input[name="next"]').off("click").on("click",function(){var b=a(this);if(!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+\-submit$/)}).is(":disabled")){var c=!1;return a(".rating span").each(function(){a(this).hasClass("star")&&(c=!0)}),c?(b.submit(),!0):(a(".studentquiz_behaviour > .vote > .error").removeClass("hide"),!1)}return b.submit(),!0}),b()}}});